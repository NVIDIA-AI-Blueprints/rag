# MIG-optimized resource configuration for RAG Blueprint
# This file only overrides GPU resource requirements to use MIG slices

# Ingestor Server - reduce concurrency for MIG
ingestor-server:
  envVars:
    NV_INGEST_FILES_PER_BATCH: "4"
    NV_INGEST_CONCURRENT_BATCHES: "1"

# NV-Ingest configuration
nv-ingest:
  envVars:
    NV_INGEST_MAX_UTIL: 8
    MAX_INGEST_PROCESS_WORKERS: 2

  # Milvus - uses 1g.10gb MIG slice
  milvus:
    standalone:
      resources:
        limits:
          nvidia.com/gpu: "0"
          nvidia.com/mig-1g.10gb: 1
        requests:
          nvidia.com/gpu: "0"
          nvidia.com/mig-1g.10gb: 1

  # NV-Ingest NIM Operator overrides
  nimOperator:
    # Page Elements - uses 1g.10gb
    page_elements:
      resources:
        limits:
          nvidia.com/gpu: "0"
          nvidia.com/mig-1g.10gb: 1
        requests:
          nvidia.com/gpu: "0"
          nvidia.com/mig-1g.10gb: 1
      storage:
        pvc:
          storageClass: ""

    # Graphic Elements - uses 1g.10gb
    graphic_elements:
      resources:
        limits:
          nvidia.com/gpu: "0"
          nvidia.com/mig-1g.10gb: 1
        requests:
          nvidia.com/gpu: "0"
          nvidia.com/mig-1g.10gb: 1
      storage:
        pvc:
          storageClass: ""

    # Table Structure - uses 1g.10gb
    table_structure:
      resources:
        limits:
          nvidia.com/gpu: "0"
          nvidia.com/mig-1g.10gb: 1
        requests:
          nvidia.com/gpu: "0"
          nvidia.com/mig-1g.10gb: 1
      storage:
        pvc:
          storageClass: ""

    # OCR - uses 3g.40gb (larger slice)
    nemoretriever_ocr_v1:
      resources:
        limits:
          nvidia.com/gpu: "0"
          nvidia.com/mig-3g.40gb: 1
        requests:
          nvidia.com/gpu: "0"
          nvidia.com/mig-3g.40gb: 1
      storage:
        pvc:
          storageClass: ""
# Main NIM Operator overrides for MIG
nimOperator:
  # LLM - uses 7g.80gb
  nim-llm:
    resources:
      limits:
        nvidia.com/gpu: "0"
        nvidia.com/mig-7g.80gb: 1
      requests:
        nvidia.com/gpu: "0"
        nvidia.com/mig-7g.80gb: 1
      storage:
        pvc:
          storageClass: ""
  # Embedding - uses 1g.10gb
  nvidia-nim-llama-32-nv-embedqa-1b-v2:
    resources:
      limits:
        nvidia.com/gpu: "0"
        nvidia.com/mig-1g.10gb: 1
      requests:
        nvidia.com/gpu: "0"
        nvidia.com/mig-1g.10gb: 1
      storage:
        pvc:
          storageClass: ""
  # Reranking - uses 1g.20gb
  nvidia-nim-llama-32-nv-rerankqa-1b-v2:
    resources:
      limits:
        nvidia.com/gpu: "0"
        nvidia.com/mig-1g.20gb: 1
      requests:
        nvidia.com/gpu: "0"
        nvidia.com/mig-1g.20gb: 1
      storage:
        pvc:
          storageClass: ""
